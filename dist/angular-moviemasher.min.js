!function(){"use strict";function d(e,t){var r,a;if(e){if(e.indexOf)return e.indexOf(t);for(a=e.length,r=0;r<a;r++)if(e[r]===t)return r}return-1}function u(e){for(;e&&!e.data("amm-directive");)e=e.parent();return e}function _(e){for(var t=0,r=[],a=e[t];a;)r.push(a),a=e[++t];return r.join("")}var h={rest:{media:{search:{url:"php/media.php?group=:group",params:{group:"@group"},method:"get",isArray:!0}},module:{search:{url:"php/media.php?group=:group",params:{group:"@group"},method:"get",isArray:!0}},mash:{search:{url:"php/media.php?group=mash",method:"get",isArray:!0},data:{url:"php/mash.php?id=:id",params:{id:"@id"},method:"get"},save:{url:"php/save.php?id=:id",params:{id:"@id"},method:"post"}},import:{api:{url:"php/import_api.php",method:"post"},init:{url:"php/import_init.php",method:"post"},monitor:{url:"php/import_monitor.php",method:"post"}},export:{init:{url:"php/export_init.php",method:"post"},monitor:{url:"php/export_monitor.php",method:"post"}}}},e=angular.module("angular.moviemasher",["ngResource","ngAnimate","colorpicker.module","angularFileUpload","ui.bootstrap"]);e.config(["$httpProvider",function(e){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0}]),e.constant("amm_resources",{}),e.config(["$provide",function(e){var r=["$http"],a=MovieMasher,t=a.prototype;a.$inject=r,t.initialize=function(){this.registered=a.registered,this.supported=a.supported;var e,t=r.length;for(this.amm_injected={},e=0;e<t;e++)this.amm_injected[r[e]]=this.instance_arguments[e]},t.__player=null,Object.defineProperty(t,"player",{get:function(){return this.__player||(this.__player=a.player()),this.__player},set:function(e){this.__player=e}}),e.service("$amm",a)}]),e.directive("ammUi",["$amm","amm_resources","$resource",function(d,u,f){return{templateUrl:"views/ui.html",restrict:"AEC",controller:["$scope","$window","$interval","amm_resources",function(m,i,l,c){m.amm_resources=c;function s(e){for(var t=d.mashes.length,r=0;r<t;r++)if(d.mashes[r].id===e)return d.mashes[r];return!1}var n=-1,p={};d.player.did=function(e){e&&n>=d.player.action_index&&(n=-2)},m.amm_export_displayed_status=function(){m.amm_export_completed=0},m.amm_export_completed=0,m.amm_import_completed=0,m.amm_export_status="",m.amm_import_status="",d.render=function(){var n=d.mash_id;c.export&&(m.amm_export_completed=.01,c.export.init({id:n},function(e){var t,r,a,o,i;e.ok?(m.amm_export_completed=.02,t=e,r=n,a=!1,i=o=0,o=l(function(){a||(a=!0,c.export.monitor(t,function(e){var t;a=!1,e.ok?0<e.completed&&e.completed<1?m.amm_export_completed=Math.max(.03,e.completed):(l.cancel(o),1===e.completed&&((t=s(r))&&(t.source=e.source),m.amm_export_completed=0)):(m.amm_export_status=e.error||_(e),m.amm_export_completed=-1,l.cancel(o))},function(e){a=!1,e.status||i++,5<i&&(m.amm_export_status=String(i)+" error responses from export monitor cgi",m.amm_export_completed=-1,l.cancel(o))}))},5e3)):(m.amm_export_status=e.error||_(e),m.amm_export_completed=-1)},function(e){console.error("export.init",e),m.amm_export_status="error response from export init",m.amm_export_completed=-1}))},d.can=function(e){var t=!1;switch(e){case"render":t=c.export&&d.player.duration&&!d.can("save");break;case"save":t=c.mash&&c.mash.save&&n!==d.player.action_index}return t},d.save=function(r){var a,o;c.mash&&c.mash.save&&(a=d.mash_id,o=d.player.action_index,c.mash.save({id:a},d.player.mash,function(e){var t;e.ok?a===d.mash_id&&(n=o,p[a]&&delete p[a],(t=s(a))&&(t.label=d.player.mash.label),r&&(d.mash_id=r,d.mash_id_change())):i.alert(e.error||_(e))}))},m.amm_view_mash=function(){i.open(d.selected_mash.source)},d.mash_id_change=function(){var e,t=d.mash_id,r=d.player.mash.id;d.can("save")?(d.mash_id=r,i.confirm('Save changes to "'+d.player.mash.label+'"?')&&d.save(t)):(e={},t?(r=s(t))&&(d.selected_mash=r,e.label=r.label,e.id=t,p[t]||c.mash&&c.mash.data({id:t},function(e){e.ok?t===d.mash_id&&(n=-1,d.player.mash=e.data):i.alert(e.error||_(e))})):(e.label="New Untitled Mash",e.id=d.player.uuid(),p[e.id]=!0,d.mashes.push(e),d.mash_id=e.id,d.selected_mash=e),d.mash_id===e.id&&(n=-1,d.player.mash=e))},d.mashes=[],d.mash_id=0,m.$amm=d,m.log_mash=function(){},m.amm_style_media_icon=function(e){var t,r={};if(e.icon)t=e.icon;else switch(e.type){case"image":t=e.url||e.source;break;case"audio":t=e.wave}return"audio"===e.type&&(r["background-size"]="100% 100%"),t&&(r["background-image"]="url("+t+")"),r},m.amm_media_icon_url=function(e){var t;if(e)if(e.icon)t=e.icon;else switch(e.type){case"image":t=e.url||e.source;break;case"audio":t=e.wave}return t}}],link:function(e,t,r){var a,o,i,n,m,l,c,s,p;for(l in d.MovieMasher.configure({mash:{default:{quantize:10}}}),r.$attr)switch(l){case"class":case"ammUi":break;default:if(s=r.$attr[l],c=r[l],"amm"===(m=s.split("-")).shift())for(i=m.length,a=p=p||{},o=0;o<i;o++)a[n=m[o]]||(a[n]=o===i-1?c:{}),a=a[n]}!function(e,t,r){var a,o,i,n,m,l;for(n in e=e||h,h.rest)if((m=h.rest[n])!==(l=e.rest[n])&&!0!==l||(l=m),l){for(o in i={},l)a={},m[o].isArray&&(a.isArray=!0),a.method=m[o].method,a.url=l[o].url,l[o].params&&(a.params=l[o].params),i[o]=a;t[n]=r(null,null,i)}}(p,u,f),u.module&&u.module.search&&(u.module.search({group:"font"},function(e){d.MovieMasher.register("font",e),u.mash&&u.mash.search({},function(e){e.length&&(angular.forEach(e,function(e){d.mashes.push(e)}),d.mash_id=d.mashes[0].id),d.mash_id_change()})}),u.module.search({group:"filter"},function(e){d.MovieMasher.register("filter",e)}),u.module.search({group:"scaler"},function(e){d.MovieMasher.register("scaler",e)}),u.module.search({group:"merger"},function(e){d.MovieMasher.register("merger",e)}))}}}]),e.directive("ammPlayer",["$window","$amm",function(o,i){return{restrict:"AEC",replace:!1,template:'<canvas id="amm-canvas"></canvas>',link:function(e,t){var r,a;o.CanvasRenderingContext2D&&(r=t.find("canvas"),a=t[0].getBoundingClientRect(),r.attr("width",a.width),r.attr("height",a.height),i.player.canvas_context=r[0].getContext("2d"),t.on("$destroy",function(){i.player.destroy()}))}}}]),e.directive("ammBrowser",["$timeout","$interval","$amm","amm_resources",function(r,l,e,c){return{restrict:"AEC",replace:!1,controller:["$scope","FileUploader",function(i,e){function n(){for(var e,t=0,r=0,a=m.length,o=0;o<a;o++){if(-1===(e=m[o]).completed)return i.amm_import_completed=-1,i.amm_import_status=e.status,0;r++,t+=e.completed}i.amm_import_completed=r?t/r:0,i.amm_import_status=""}function a(e){for(var t,r=m.length,a=0;a<r;a++)if((t=m[a]).upload===e)return t;return!1}var e=i.uploader=new e({scope:i}),t={},m=[];c.import&&(e.onProgressItem=function(e,t){var r=a(e);r?(r.completed=Math.max(.03,t/200),n()):console.error("could not find upload for item",e)},e.onAfterAddingFile=function(r){var e={};e.file=r.file.name,e.size=r.file.size,e.type=r.file.type;var a={uploading:!0};a.upload=r,a.completed=.01,a.name=e.name,m.unshift(a),n();function o(e,t){e.completed=-1,e.status=t,n()}c.import.init(e,function(e){if(e.ok){if(a.completed=.02,r.formData.push(e.data),e.headers)for(var t in e.headers)r.headers[t]=e.headers[t];a.api=e.api,r.url=e.endpoint,r.method=e.method,r.upload()}else o(a,e.error||_(e))},function(){o(a,"error")})},e.onSuccessItem=function(e,t){var o=a(e);o?t.error?(o.status=t.error,o.completed=-1):o.api?(o.completed=.5,c.import.api&&r(function(){c.import.api(o.api,function(e){var r,a,t;e.ok&&c.import.monitor?(o.monitor=e.monitor,o.completed=.51,a=!1,t=0,(r=o).interval_id=0,r.interval_id=l(function(){a||(a=!0,c.import.monitor(r.monitor,function(e){var t;a=!1,e.ok?0<e.completed&&e.completed<1?r.completed=.5+e.completed/2:(l.cancel(r.interval_id),e.type?("video"===(t=e.type)&&e.no_video&&"false"!==e.no_video&&(t="audio"),i.amm_browser_group_change(t)):console.error("import_monitor_response did not include type key",e),-1<(t=m.indexOf(r))?m.splice(t,1):console.error("could not delete upload",r)):(r.completed=-1,r.status=e.error||_(e),l.cancel(r.interval_id)),n()},function(e){a=!1,e.status||t++,5<t&&(r.status=String(t)+" error responses from import monitor cgi",r.completed=-1,l.cancel(r.interval_id),n())}))},5e3)):(o.status=e.error||_(e),o.completed=-1),n()})},20)):console.error("upload had no api key?",o):console.error("could not find upload for item?",e),n()},e.onErrorItem=function(e){var t=a(e);t?(t.status="problem uploading "+t.file,t.completed=-1,n()):console.error("could not find upload for item",e)}),c.module&&c.module.search?i.amm_browser_group="theme":i.amm_browser_group="video",i.amm_import_displayed_status=function(){for(var e=m.length,t=0;t<e;t++)if(-1===m[t].completed){m.splice(t,1);break}n()},i.amm_browser_group_change=function(e){if(e&&(i.amm_browser_group=e,t[i.amm_browser_group]&&delete t[i.amm_browser_group]),!t[i.amm_browser_group])switch(i.amm_browser_group){case"image":case"video":case"audio":c.media&&(t[i.amm_browser_group]=c.media.search({group:i.amm_browser_group}));break;default:c.module&&(t[i.amm_browser_group]=c.module.search({group:i.amm_browser_group}))}i.amm_media=t[i.amm_browser_group]},i.amm_browser_group_change()}]}}]),e.directive("ammDragMedia",["$amm","$parse",function(e,i){return{restrict:"AEC",templateUrl:"views/browser/clip.html",link:function(a,e,o){e.bind("dragstart",function(e){var t=o.ammDragMedia,r=i(t)(a),t={media:r,x:e.layerX,y:e.layerY},r="amm-"+r.type;e.dataTransfer.effectAllowed="link",e.dataTransfer.setData(r,angular.toJson(t))})}}}]),e.directive("ammInspector",["$amm",function(a){return{restrict:"AEC",replace:!1,link:function(e){e.amm_inspector_include=function(e){var t,r;if(e)if(e===a.player.mash)t="views/inspector/mash.html";else if(r=a.player.media(e))if(r.inspector)t=r.inspector;else switch(r.type){case"theme":case"transition":if(r.html){t=r.html;break}case"video":case"audio":case"image":t="views/inspector/"+r.type+".html";break;default:t=r.html}return t}}}}]),e.directive("ammInspectorEffects",["$amm",function(m){return{restrict:"AEC",controller:["$scope","$element","$amm",function(c,s){var p=this;p.__effects_drag_data=function(e,t){var r,a,o,i,n,m,l;if(e&&(a=function(e){for(var t,r=["amm-effects","amm-effect"],a=r.length,o=0;o<a;o++)if(-1<d(e,t=r[o]))return t;return!1}(e.dataTransfer.types))){for(n=!0,o={type:a,multiple:"amm-effects"===a,over_index:-1},t&&(o.data=e.dataTransfer.getData(a),o.data&&(o.data=angular.fromJson(o.data))),r={},l=angular.element(e.target);(l=l&&u(l))&&"ammInspectorEffects"!==(m=l.data("amm-directive"));)l=(r[m]=l).parent();r.ammInspectorEffect&&(i=r.ammInspectorEffect,o.effect=i.data("amm-object"))}return p.__over_effect_element===i&&p.__drop_ok===n||c.$apply(function(){var e;p.__over_effect_element!==i&&(p.__over_effect_element&&p.__over_effect_element.toggleClass("amm-drop-dragover",!1),p.__over_effect_element=i,p.__over_effect_element&&(o.over_index=(e=i,Array.prototype.indexOf.call(e[0].parentNode.childNodes,e[0])),p.__over_effect_element.toggleClass("amm-drop-dragover",!0))),p.__drop_ok!==n&&(p.__drop_ok=n,s.toggleClass("amm-drop-dragover",p.__drop_ok))}),n&&(e.preventDefault(),e.dataTransfer.dropEffect=o.multiple?"move":"link"),o}}],link:function(o,i,e,n){i.data("amm-directive","ammInspectorEffects"),i.bind("dragenter",n.__effects_drag_data),i.bind("dragover",n.__effects_drag_data),i.bind("dragleave",function(){n.__effects_drag_data()}),i.bind("drop",function(e){var t,r,a=n.__effects_drag_data(e,!0);a&&(t=m.player.selectedClipOrMash.effects,-1===(r=a.over_index)&&(r=t.length),console.log("effects.drop",e.timeStamp),o.$apply(function(){i.toggleClass("amm-drop-dragover",!1),a.multiple?(console.log("drop move",m.player.selectedEffects,"effect",r),m.player.move(m.player.selectedEffects,"effect",r)):(console.log("effect drop add",a.data.media,"effect",r),m.player.add(a.data.media,"effect",r))}),e.stopPropagation&&e.stopPropagation(),e.preventDefault())}),i.bind("dragend",function(e){"none"===e.dataTransfer.dropEffect&&o.$apply(function(){m.player.remove(m.player.selectedEffects,"effect")})})}}}]),e.directive("ammInspectorEffect",["$amm","$parse",function(o,i){return{restrict:"A",link:function(e,t,r){t.data("amm-directive","ammInspectorEffect"),t.data("amm-object",e.effect);var a=i(r.ammInspectorEffect)(e);t.attr("draggable",!0),t.bind("dragstart",function(e){var t;o.player.selected(a)?(t={effects:o.player.selectedEffects,x:e.layerX,y:e.layerY},e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("amm-effects",angular.toJson(t))):(e.stopPropagation&&e.stopPropagation(),e.preventDefault())})}}}]),e.directive("ammTimeline",["$amm",function(){return{restrict:"AEC",controller:["$scope","$element","$amm",function(c,s,n){var p=this,r=[];p.scrollLeft=0,p.scrollTop=0;function t(){for(var e=r.length,t=0;t<e;t++)r[t]()}p.pixels_from_frame=function(e,t,r,a){r=r||n.player.mash.quantize;var o,i=0;return e&&(o=p.pixels_per_second(a))&&(i=e/r*o,!t&&void 0!==t||(i=Math[t||"ceil"](i))),i},p.frame_from_pixels=function(e,t,r){r=r||n.player.mash.quantize;var a,o=0;return e&&(a=p.pixels_per_second())&&(o=e/a*r,!t&&void 0!==t||(o=Math[t||"round"](o))),o},p.pixels_per_second=function(e){var t=0,r=e?0:20,e=n.player?n.player.duration:0;return e&&(t=(c.amm_timeline_width()-r)/(e*(1.01-Math.max(.01,Math.min(1,c.amm_zoom))))),t},p.register_scroller=function(e){r.push(e)},p.timeline_drag_data=function(e,t){var r,a,o,i,n,m,l;if(e&&(a=function(e){for(var t,r=["amm-clips-audio","amm-clips-overlays","amm-clips-video","amm-transition","amm-image","amm-frame","amm-theme","amm-video","amm-audio"],a=r.length,o=0;o<a;o++)if(-1<d(e,t=r[o]))return t;return!1}(e.dataTransfer.types))){for(o={type:a,multiple:"amm-clips-"===a.substr(0,10)},t&&(o.data=e.dataTransfer.getData(a),o.data&&(o.data=angular.fromJson(o.data))),r={},l=angular.element(e.target);(l=l&&u(l))&&"ammTimelineTracks"!==(m=l.data("amm-directive"));)l=(r[m]=l).parent();r.ammTimelineTrack&&(o.track=r.ammTimelineTrack.data("amm-object"),r.ammTimelineClip&&(o.clip=r.ammTimelineClip.data("amm-object")),o.multiple?n=(n="amm-clips-"+o.track.type===o.type)||"video"===o.track.type&&"amm-clips-overlays"===o.type:(n="amm-"+o.track.type===o.type)||"video"!==o.track.type||(n="amm-transition"===o.type?!o.track.index:"amm-audio"!==o.type),n&&(i=r.ammTimelineTrack))}return p.__over_track_element===i&&p.__drop_ok===n||c.$apply(function(){p.__over_track_element!==i&&(p.__over_track_element&&p.__over_track_element.toggleClass("amm-drop-dragover",!1),p.__over_track_element=i,p.__over_track_element&&p.__over_track_element.toggleClass("amm-drop-dragover",!0)),p.__drop_ok!==n&&(p.__drop_ok=n,s.parent().toggleClass("amm-drop-dragover",p.__drop_ok))}),e&&e.preventDefault(),n&&(e.dataTransfer.dropEffect=o.multiple?"move":"all"),o},p.track_for_clips=function(e){for(var t,r=e.length,a=0;a<r;a++){switch(n.player.media(e[a]).type){case"audio":t="audio";break;case"transition":t="video"}if(t)break}return t=t||"overlays"},c.amm_timeline_scroll=function(e){p.scrollLeft=e.target.scrollLeft,p.scrollTop=e.target.scrollTop,t()},c.amm_selected_class=function(e){return{"amm-selected":n.player.selected(e)}},c.amm_style_clip=function(e,t){var r={},a=n.player.media(e);return r.width=p.pixels_from_frame(e.frames,"floor")+"px",r["z-index"]=100*("transition"===a.type?10:1)+t.clips.indexOf(e),r.left=p.pixels_from_frame(e.frame,"floor")+"px",r.position="absolute",r},c.amm_timeline_view_width=function(){var e=n.player?n.player.duration:0,e=e?e*p.pixels_per_second(!0):c.amm_timeline_width();return e},c.amm_zoom=0,c.$watch("amm_zoom",function(){var e=p.pixels_from_frame(n.player.frame,"round",n.player.fps,!0);e-=c.amm_timeline_width()/2,p.scrollLeft=Math.max(0,e),t()})}]}}]),e.directive("ammTimelineTrackControls",["$amm",function(){return{restrict:"AEC",require:"^ammTimeline",link:function(e,t,r,a){a.register_scroller(function(){t[0].scrollTop=a.scrollTop}),e.amm_track_controls_width=function(){return t[0].getBoundingClientRect().width}}}}]),e.directive("ammTimelineRuler",["$amm","$document",function(l,c){return{restrict:"E",require:"^ammTimeline",link:function(r,t,e,a){function o(t){r.$apply(function(){var e=t.pageX-m,e=a.frame_from_pixels(e,"round",l.player.fps);l.player.frame=Math.max(0,Math.min(l.player.frames,e))})}function i(e){o(e),n.unbind("mousemove"),n.unbind("mouseup"),n.unbind("mouseleave")}var n=angular.element(c[0].body),m=0;t.bind("mousedown",function(e){m=t[0].getBoundingClientRect().left+r.amm_track_controls_width()-a.scrollLeft,o(e),n.bind("mousemove",o),n.bind("mouseup",i),n.bind("mouseleave",i)})}}}]),e.directive("ammTimelineRule",["$amm",function(o){return{restrict:"E",require:"^ammTimeline",link:function(t,r,e,a){a.register_scroller(function(){t.$$phase||t.$apply(function(){})}),t.amm_style_rule=function(){var e={};return e.left=a.pixels_from_frame(o.player.frame,"round",o.player.fps),e.left-=Math.round(r[0].getBoundingClientRect().width/2),e.left+=t.amm_track_controls_width()-a.scrollLeft,e.left=String(e.left)+"px",console.log("amm_style_rule",e.left),e}}}}]),e.directive("ammTimelineTracks",["$timeout","$amm","$window","$rootScope",function(t,m,e,r){return e.onresize=function(){r.$apply(function(){})},{restrict:"AEC",require:"^ammTimeline",link:function(o,i,e,n){n.register_scroller(function(){i[0].scrollLeft!==n.scrollLeft&&t(function(){i[0].scrollLeft=n.scrollLeft})}),o.amm_timeline_width=function(){return i[0].getBoundingClientRect().width},i.data("amm-directive","ammTimelineTracks"),e.$set("class","amm-timeline-tracks"),i.bind("scroll",o.amm_timeline_scroll),i.bind("dragenter",n.timeline_drag_data),i.bind("dragover",n.timeline_drag_data),i.bind("dragleave",function(){}),i.bind("drop",function(e){var t,r,a=n.timeline_drag_data(e,!0);a&&(e.dataTransfer.dropEffect,n.timeline_drag_data(),m.player.mash[a.track.type],r=a.track.index,t="video"!==a.track.type||r?Math.max(0,n.frame_from_pixels(e.pageX-i[0].getBoundingClientRect().left-a.data.x)):a.clip?a.track.clips.indexOf(a.clip):a.track.clips.length,o.$apply(function(){a.multiple?m.player.move(m.player.selectedClips,a.track.type,t,r):m.player.add(a.data.media,a.track.type,t,r)}),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault())})}}}]),e.directive("ammTimelineTrack",["$amm",function(r){return{restrict:"AEC",link:function(e,t){t.data("amm-directive","ammTimelineTrack"),t.data("amm-object",e.track),t.bind("mousedown",function(){e.$apply(function(){r.player.select(!1)})})}}}]),e.directive("ammTimelineClip",["$amm","$parse",function(l){return{restrict:"E",require:"^ammTimeline",templateUrl:"views/timeline/clip.html",replace:!0,link:function(n,e,t,m){e.data("amm-directive","ammTimelineClip"),e.data("amm-object",n.clip),e.bind("mousedown",function(e){n.$apply(function(){l.player.select(n.clip,e.shiftKey),e.stopPropagation&&e.stopPropagation()})}),e.bind("dragstart",function(e){if(l.player.selected(n.clip)){e.dataTransfer.effectAllowed="copyMove";for(var t,r={},a={clips:l.player.selectedClips,x:e.layerX,y:e.layerY,media:[]},o=a.clips.length,i=(1<o&&e.dataTransfer.addElement,0);i<o;i++)t=a.clips[i],r[(t=l.player.media(t)).id]||(r[t.id]=!0,a.media.push(t));e.dataTransfer.setData("amm-clips-"+m.track_for_clips(a.clips),angular.toJson(a))}else e.stopPropagation&&e.stopPropagation(),e.preventDefault()}),e.bind("dragend",function(e){"none"===e.dataTransfer.dropEffect&&n.$apply(function(){l.player.remove(l.player.selectedClips,n.track.type,n.track.index)})}),e.on("$destroy",function(){e.data("amm-object",null),e.data("amm-directive",null)})}}}]),e.directive("ammSynced",["$amm","$interval",function(e,t){return{restrict:"AEC",link:function(){t(function(){},100)}}}]),e.filter("secondsFromFrames",function(){return function(e,t){return e/t}}),e.filter("displaySeconds",function(){function m(e,t,r){return r=r||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(r)+e}return function(e,t,r){var a,o,i="",n=2;return(a=3600)<=(r=r||e)&&(a<=e?(i+=m(String(Math.floor(e/a)),n),o=!0,e%=a):i+="00:"),a=60,(o||a<=r)&&(o&&(i+=":"),a<=e?(i+=m(String(Math.floor(e/a)),n),o=!0,e%=a):i+="00:"),a=1,o||a<=r?(o&&(i+=":"),a<=e?(i+=m(String(Math.floor(e/a)),n),o=!0,e%=a):i+="00"):i+="00",1<t&&(10===t&&(n=1),i+=".",e?(e=1===n?Math.floor(10*e)/10:Math.floor(100*e)/100,e=Number(String(e).substr(2,2)),i+=m(String(e),n)):i+=m("0",n)),i}})}();